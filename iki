function validateForm() {
  const mortgageAmount = document.getElementById("mortgageAmount");
  const mortgageTerm = document.getElementById("mortgageTerm");
  const interestRate = document.getElementById("interestRate");
  const repayment = document.getElementById("repayment");
  const interestOnly = document.getElementById("interestOnly");

  const inputs = [
    { field: mortgageAmount, message: "This field is required" },
    { field: mortgageTerm, message: "This field is required" },
    { field: interestRate, message: "This field is required" },
  ];

  let hasError = false;

  inputs.forEach(({ field, message }) => {
    const errorElement = field.nextElementSibling;
    if (field.value.trim() === "") {
      field.classList.add("error");
      if (!errorElement || !errorElement.classList.contains("error-message")) {
        const errorMessage = document.createElement("span");
        errorMessage.className = "error-message";
        errorMessage.textContent = message;
        field.parentNode.appendChild(errorMessage);
      }
      hasError = true;
    } else {
      field.classList.remove("error");
      if (errorElement && errorElement.classList.contains("error-message")) {
        errorElement.remove();
      }
    }
  });

  if (!repayment.checked && !interestOnly.checked) {
    const mortgageTypeError = document.getElementById("mortgageTypeError");
    if (!mortgageTypeError) {
      const errorMessage = document.createElement("span");
      errorMessage.className = "error-message";
      errorMessage.id = "mortgageTypeError";
      errorMessage.textContent = "Please select a Mortgage Type";
      document.querySelector(".mb-4").appendChild(errorMessage);
    }
    hasError = true;
  } else {
    const mortgageTypeError = document.getElementById("mortgageTypeError");
    if (mortgageTypeError) {
      mortgageTypeError.remove();
    }
  }

  if (!hasError) {
    calculateSum();
  }
}

document.getElementById("calculateButton").addEventListener("click", validateForm);

function calculateSum() {
  const mortgageAmount = parseFloat(document.getElementById("mortgageAmount").value.replace(/,/g, ""));
  const mortgageTerm = parseFloat(document.getElementById("mortgageTerm").value);
  const interestRate = parseFloat(document.getElementById("interestRate").value);

  if (isNaN(mortgageAmount) || isNaN(mortgageTerm) || isNaN(interestRate)) {
    alert("Please enter valid values in all fields.");
    return;
  }

  const isRepaymentSelected = document.getElementById("repayment").checked;
  const isInterestOnlySelected = document.getElementById("interestOnly").checked;

  if (!isRepaymentSelected && !isInterestOnlySelected) {
    alert("Please select a mortgage type: Repayment or Interest Only.");
    return;
  }

  if (isRepaymentSelected) {
    isRepayment();
  } else if (isInterestOnlySelected) {
    isInterestOnly();
  }
}

function isRepayment() {
  const mortgageAmount = parseFloat(document.getElementById("mortgageAmount").value.replace(/,/g, ""));
  const mortgageTerm = parseFloat(document.getElementById("mortgageTerm").value);
  const interestRate = parseFloat(document.getElementById("interestRate").value);

  const months = mortgageTerm * 12;
  const monthlyRate = interestRate / 100 / 12;
  const repayment = (mortgageAmount * monthlyRate) / (1 - Math.pow(1 + monthlyRate, -months));
  const monthlyInterest = (mortgageAmount * (interestRate / 100)) * 12;

  document.getElementById("result").value = `£${repayment.toFixed(2)}`;
  document.getElementById("results2").value = `£${monthlyInterest.toFixed(2)}`;
  document.querySelector(".results").style.display = "none";
  document.querySelector(".results-2").style.display = "block";
}

function isInterestOnly() {
  const mortgageAmount = parseFloat(document.getElementById("mortgageAmount").value.replace(/,/g, ""));
  const mortgageTerm = parseFloat(document.getElementById("mortgageTerm").value);
  const interestRate = parseFloat(document.getElementById("interestRate").value);

  const monthlyInterest = (mortgageAmount * (interestRate / 100)) * 12;

  document.getElementById("result").value = `£0`;
  document.getElementById("results2").value = `£${monthlyInterest.toFixed(2)}`;
  document.querySelector(".results").style.display = "none";
  document.querySelector(".results-2").style.display = "block";
}
